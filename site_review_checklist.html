<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrandFlow 배포 사이트 검토</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-pass { color: #10b981; }
        .status-fail { color: #ef4444; }
        .status-warning { color: #f59e0b; }
        .status-testing { color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- 헤더 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1 class="text-3xl font-bold text-center mb-4 text-gray-800">
                    🚀 BrandFlow 배포 사이트 검토
                </h1>
                <div class="text-center">
                    <a href="https://brandflo.netlify.app" target="_blank" 
                       class="text-blue-600 hover:text-blue-800 text-xl font-semibold">
                        https://brandflo.netlify.app
                    </a>
                </div>
                <div class="grid md:grid-cols-3 gap-4 mt-6 text-sm">
                    <div class="p-3 bg-blue-50 rounded text-center">
                        <strong>🌐 프론트엔드</strong><br>
                        React + Vite (Netlify)
                    </div>
                    <div class="p-3 bg-green-50 rounded text-center">
                        <strong>🔧 백엔드</strong><br>
                        FastAPI (Render)
                    </div>
                    <div class="p-3 bg-purple-50 rounded text-center">
                        <strong>⚡ 배포 상태</strong><br>
                        GitHub 자동 배포
                    </div>
                </div>
            </div>

            <!-- 테스트 결과 -->
            <div id="testResults" class="space-y-4">
                <div class="text-center text-gray-500">
                    테스트를 시작하려면 버튼을 클릭하세요.
                </div>
            </div>

            <!-- 버튼 영역 -->
            <div class="flex justify-center space-x-4 mt-8">
                <button id="testBtn" onclick="runComprehensiveTests()" 
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg">
                    🧪 종합 사이트 검토 시작
                </button>
                
                <button onclick="exportResults()" 
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg">
                    📊 검토 결과 다운로드
                </button>
            </div>

            <!-- 수동 체크리스트 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
                <h2 class="text-2xl font-bold mb-4">📋 수동 검토 체크리스트</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-blue-600">🎯 핵심 기능</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 사이트 로딩 (3초 이내)
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 로그인 페이지 접근
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 대시보드 데이터 로딩
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 캠페인 목록 조회
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 구매요청 기능
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 모든 페이지 라우팅
                            </label>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-green-600">✨ 신규 기능</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 실시간 알림 (WebSocket)
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 다중 파일 업로드
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 드래그앤드롭 업로드
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 데이터 내보내기 (Excel/PDF)
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 고급 검색/필터링
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 자동완성 검색
                            </label>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-purple-600">📱 사용자 경험</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 모바일 반응형
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 로딩 스피너 표시
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 에러 메시지 표시
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 새로고침 시 라우팅 유지
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 브라우저 뒤로가기
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 다국어 지원 (한국어)
                            </label>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-red-600">🛡️ 보안 & 성능</h3>
                        <div class="space-y-2 text-sm">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> HTTPS 강제 적용
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 보안 헤더 적용
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> API CORS 정상 동작
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> WebSocket WSS 연결
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> 캐시 동작 확인
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2"> Lighthouse 점수 80+
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let reviewResults = {
            timestamp: new Date().toISOString(),
            site_url: 'https://brandflo.netlify.app',
            tests: {},
            manual_checks: {},
            summary: {}
        };

        async function runComprehensiveTests() {
            const btn = document.getElementById('testBtn');
            const resultsDiv = document.getElementById('testResults');
            
            btn.disabled = true;
            btn.textContent = '🔄 종합 검토 진행 중...';
            
            resultsDiv.innerHTML = '<div class="text-center text-blue-500">BrandFlow 사이트를 종합 검토하고 있습니다...</div>';
            
            // 테스트 실행
            await testSiteAccessibility();
            await testAPIConnectivity();
            await testWebSocketConnection();
            await testPerformance();
            await testSecurity();
            await testResponsiveness();
            
            // 결과 요약
            generateReviewSummary();
            displayReviewResults();
            
            btn.disabled = false;
            btn.textContent = '🧪 종합 사이트 검토 시작';
        }

        async function testSiteAccessibility() {
            const test = { name: '사이트 접근성', status: 'testing' };
            
            try {
                const response = await fetch('https://brandflo.netlify.app', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                
                test.status = 'pass';
                test.message = 'Netlify 사이트 정상 접근 가능';
                test.details = {
                    url: 'https://brandflo.netlify.app',
                    protocol: 'HTTPS',
                    cdn: 'Netlify Global CDN'
                };
            } catch (error) {
                test.status = 'warning';
                test.message = '직접 접근 테스트 필요';
                test.details = { error: error.message };
            }
            
            reviewResults.tests.site_accessibility = test;
        }

        async function testAPIConnectivity() {
            const test = { name: '백엔드 API 연결', status: 'testing' };
            
            const apiEndpoints = [
                'https://brandflow-backend2.onrender.com/health',
                'https://brandflow-backend2.onrender.com/docs',
                'https://brandflow-backend2.onrender.com/api/campaigns/'
            ];

            let successCount = 0;
            const results = [];

            for (const endpoint of apiEndpoints) {
                try {
                    const response = await fetch(endpoint, {
                        method: 'GET',
                        mode: 'cors'
                    });
                    
                    const success = response.ok || response.status === 401;
                    results.push({
                        endpoint: endpoint,
                        status: response.status,
                        success: success
                    });
                    
                    if (success) successCount++;
                } catch (error) {
                    results.push({
                        endpoint: endpoint,
                        error: error.message,
                        success: false
                    });
                }
            }

            test.status = successCount > 0 ? 'pass' : 'fail';
            test.message = `${successCount}/${apiEndpoints.length} API 엔드포인트 연결 성공`;
            test.details = results;

            reviewResults.tests.api_connectivity = test;
        }

        async function testWebSocketConnection() {
            const test = { name: 'WebSocket 실시간 연결', status: 'testing' };
            
            try {
                const ws = new WebSocket('wss://brandflow-backend2.onrender.com/api/websocket/ws');
                
                await new Promise((resolve) => {
                    const timeout = setTimeout(() => {
                        ws.close();
                        test.status = 'warning';
                        test.message = 'WebSocket 연결 타임아웃 (서버 확인 필요)';
                        resolve();
                    }, 5000);
                    
                    ws.onopen = () => {
                        clearTimeout(timeout);
                        test.status = 'pass';
                        test.message = 'WebSocket WSS 프로토콜 연결 성공';
                        ws.close();
                        resolve();
                    };
                    
                    ws.onerror = () => {
                        clearTimeout(timeout);
                        test.status = 'warning';
                        test.message = 'WebSocket 연결 오류 (인증 필요)';
                        resolve();
                    };

                    ws.onclose = (event) => {
                        clearTimeout(timeout);
                        if (event.code === 1008) {
                            test.status = 'pass';
                            test.message = 'WebSocket 서버 정상 (토큰 인증 필요)';
                        }
                        resolve();
                    };
                });
                
            } catch (error) {
                test.status = 'fail';
                test.error = error.message;
            }
            
            reviewResults.tests.websocket = test;
        }

        async function testPerformance() {
            const test = { name: '성능 및 로딩 속도', status: 'testing' };
            
            try {
                const startTime = performance.now();
                
                // 페이지 로드 성능 측정
                const loadTime = performance.timing ? 
                    (performance.timing.loadEventEnd - performance.timing.navigationStart) : 
                    'N/A';
                
                const endTime = performance.now();
                const testDuration = endTime - startTime;

                test.status = 'pass';
                test.message = '성능 측정 완료';
                test.details = {
                    pageLoadTime: loadTime + 'ms',
                    testDuration: Math.round(testDuration) + 'ms',
                    connectionType: navigator.connection ? navigator.connection.effectiveType : 'unknown'
                };

                // Lighthouse 점수는 수동 확인 필요
                test.recommendations = [
                    'Google PageSpeed Insights로 상세 분석 권장',
                    'Lighthouse 확장프로그램으로 점수 확인',
                    'Network 탭에서 리소스 로딩 시간 확인'
                ];
                
            } catch (error) {
                test.status = 'warning';
                test.error = error.message;
            }
            
            reviewResults.tests.performance = test;
        }

        async function testSecurity() {
            const test = { name: '보안 설정', status: 'testing' };
            
            try {
                // HTTPS 강제 적용 확인
                const httpsTest = window.location.protocol === 'https:';
                
                // CSP 헤더 등은 실제 사이트에서 확인 필요
                test.status = httpsTest ? 'pass' : 'fail';
                test.message = httpsTest ? 'HTTPS 보안 연결 확인됨' : 'HTTP 연결 - 보안 위험';
                test.details = {
                    protocol: window.location.protocol,
                    secureContext: window.isSecureContext,
                    origin: window.location.origin
                };
                
                test.recommendations = [
                    'Security Headers 확인: securityheaders.com에서 테스트',
                    'SSL Labs에서 SSL 등급 확인: ssllabs.com/ssltest',
                    '브라우저 개발자 도구 Security 탭 확인'
                ];
                
            } catch (error) {
                test.status = 'fail';
                test.error = error.message;
            }
            
            reviewResults.tests.security = test;
        }

        async function testResponsiveness() {
            const test = { name: '반응형 디자인', status: 'testing' };
            
            try {
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                // 기본적인 반응형 확인
                const isMobile = viewportWidth <= 768;
                const isTablet = viewportWidth > 768 && viewportWidth <= 1024;
                const isDesktop = viewportWidth > 1024;
                
                test.status = 'pass';
                test.message = '반응형 디자인 정보 수집 완료';
                test.details = {
                    screenSize: `${screenWidth}x${screenHeight}`,
                    viewportSize: `${viewportWidth}x${viewportHeight}`,
                    deviceType: isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop',
                    userAgent: navigator.userAgent
                };
                
                test.recommendations = [
                    '다양한 화면 크기에서 직접 테스트',
                    '브라우저 개발자 도구 Device 모드로 테스트',
                    '실제 모바일/태블릿 기기에서 확인'
                ];
                
            } catch (error) {
                test.status = 'fail';
                test.error = error.message;
            }
            
            reviewResults.tests.responsiveness = test;
        }

        function generateReviewSummary() {
            const tests = Object.values(reviewResults.tests);
            const passCount = tests.filter(t => t.status === 'pass').length;
            const failCount = tests.filter(t => t.status === 'fail').length;
            const warningCount = tests.filter(t => t.status === 'warning').length;
            
            reviewResults.summary = {
                total_tests: tests.length,
                passed: passCount,
                failed: failCount,
                warnings: warningCount,
                success_rate: Math.round((passCount / tests.length) * 100),
                overall_status: failCount === 0 ? 'healthy' : 'needs_attention',
                deployment_status: 'live',
                site_url: 'https://brandflo.netlify.app',
                backend_url: 'https://brandflow-backend2.onrender.com'
            };
        }

        function displayReviewResults() {
            const resultsDiv = document.getElementById('testResults');
            const { tests, summary } = reviewResults;
            
            let html = `
                <div class="mb-6 p-6 rounded-lg ${summary.overall_status === 'healthy' ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200'}">
                    <h2 class="text-2xl font-semibold mb-4 text-center">
                        🎉 BrandFlow 사이트 검토 완료!
                    </h2>
                    <div class="grid md:grid-cols-4 gap-4 text-center">
                        <div class="p-3 bg-white rounded-lg">
                            <div class="text-2xl font-bold status-pass">${summary.passed}</div>
                            <div class="text-sm">통과</div>
                        </div>
                        <div class="p-3 bg-white rounded-lg">
                            <div class="text-2xl font-bold status-warning">${summary.warnings}</div>
                            <div class="text-sm">경고</div>
                        </div>
                        <div class="p-3 bg-white rounded-lg">
                            <div class="text-2xl font-bold status-fail">${summary.failed}</div>
                            <div class="text-sm">실패</div>
                        </div>
                        <div class="p-3 bg-white rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${summary.success_rate}%</div>
                            <div class="text-sm">성공률</div>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <span class="text-lg font-semibold ${summary.overall_status === 'healthy' ? 'status-pass' : 'status-warning'}">
                            ${summary.overall_status === 'healthy' ? '✅ 사이트 정상 운영 중' : '⚠️ 일부 개선 권장'}
                        </span>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
            `;
            
            for (const [key, test] of Object.entries(tests)) {
                const statusClass = test.status === 'pass' ? 'status-pass border-green-200 bg-green-50' : 
                                  test.status === 'fail' ? 'status-fail border-red-200 bg-red-50' : 
                                  'status-warning border-yellow-200 bg-yellow-50';
                const statusIcon = test.status === 'pass' ? '✅' : 
                                 test.status === 'fail' ? '❌' : '⚠️';
                
                html += `
                    <div class="p-4 border rounded-lg ${statusClass}">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">${statusIcon} ${test.name}</h3>
                            <span class="text-sm font-medium">${test.status.toUpperCase()}</span>
                        </div>
                        <div class="text-sm text-gray-700 mb-2">
                            ${test.message || test.error || '테스트 진행 중...'}
                        </div>
                        ${test.recommendations ? `
                            <div class="text-xs text-gray-600 mt-2">
                                <strong>권장사항:</strong>
                                <ul class="list-disc list-inside mt-1">
                                    ${test.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            html += `
                </div>
                
                <div class="mt-8 p-6 bg-blue-50 border border-blue-200 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800">🎯 다음 단계 추천</h3>
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <h4 class="font-semibold mb-2">즉시 확인:</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-700">
                                <li><a href="https://brandflo.netlify.app" target="_blank" class="text-blue-600 hover:underline">사이트 직접 접속 테스트</a></li>
                                <li>로그인 기능 동작 확인</li>
                                <li>주요 페이지 이동 테스트</li>
                                <li>모바일 기기에서 접속 테스트</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">성능 분석:</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-700">
                                <li><a href="https://pagespeed.web.dev/analysis?url=https://brandflo.netlify.app" target="_blank" class="text-blue-600 hover:underline">PageSpeed Insights 분석</a></li>
                                <li><a href="https://web.dev/measure/" target="_blank" class="text-blue-600 hover:underline">Web.dev Measure 도구</a></li>
                                <li>Lighthouse 확장프로그램 실행</li>
                                <li>Network 탭에서 로딩 시간 확인</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        function exportResults() {
            const dataStr = JSON.stringify(reviewResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `brandflow_site_review_${new Date().getTime()}.json`;
            link.click();
        }

        // 페이지 로드 시 기본 정보 표시
        window.onload = function() {
            document.getElementById('testResults').innerHTML = `
                <div class="text-center p-8 bg-white rounded-lg shadow">
                    <div class="text-6xl mb-4">🎉</div>
                    <h2 class="text-2xl font-bold mb-4">BrandFlow 사이트 배포 완료!</h2>
                    <p class="text-gray-600 mb-6">
                        Netlify를 통해 성공적으로 배포된 BrandFlow 시스템을 종합 검토합니다.
                    </p>
                    <div class="inline-block p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border">
                        <div class="text-lg font-semibold text-gray-800 mb-2">🌐 라이브 사이트</div>
                        <a href="https://brandflo.netlify.app" target="_blank" 
                           class="text-blue-600 hover:text-blue-800 text-xl font-bold">
                            https://brandflo.netlify.app
                        </a>
                    </div>
                </div>
            `;
        };
    </script>
</body>
</html>