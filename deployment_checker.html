<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrandFlow ë°°í¬ ìƒíƒœ ê²€í† </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-pass { color: #10b981; }
        .status-fail { color: #ef4444; }
        .status-warning { color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
                ğŸš€ BrandFlow ë°°í¬ ìƒíƒœ ê²€í† 
            </h1>
            
            <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div id="testResults" class="space-y-4">
                <div class="text-center text-gray-500">
                    í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                </div>
            </div>
            
            <!-- ë²„íŠ¼ ì˜ì—­ -->
            <div class="flex justify-center space-x-4 mt-8">
                <button id="testBtn" onclick="runTests()" 
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                    ğŸ§ª ë°°í¬ ìƒíƒœ í…ŒìŠ¤íŠ¸ ì‹œì‘
                </button>
                
                <button onclick="exportResults()" 
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-6 rounded">
                    ğŸ“Š ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
                </button>
            </div>
            
            <!-- í”„ë¡œì íŠ¸ ì •ë³´ -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                <h2 class="text-xl font-semibold mb-4">ğŸ“‹ í”„ë¡œì íŠ¸ ì •ë³´</h2>
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <strong>ë°±ì—”ë“œ:</strong> FastAPI (Python)<br>
                        <strong>í”„ë¡ íŠ¸ì—”ë“œ:</strong> React + Vite<br>
                        <strong>ë°ì´í„°ë² ì´ìŠ¤:</strong> SQLite/PostgreSQL
                    </div>
                    <div>
                        <strong>ì‹¤ì‹œê°„ í†µì‹ :</strong> WebSocket<br>
                        <strong>ì»¨í…Œì´ë„ˆ:</strong> Docker<br>
                        <strong>í”„ë¡ì‹œ:</strong> Nginx
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};
        
        async function runTests() {
            const btn = document.getElementById('testBtn');
            const resultsDiv = document.getElementById('testResults');
            
            btn.disabled = true;
            btn.textContent = 'ğŸ”„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            
            resultsDiv.innerHTML = '<div class="text-center text-blue-500">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
            
            testResults = {
                timestamp: new Date().toISOString(),
                tests: {},
                summary: {}
            };
            
            // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            await testFrontend();
            await testBackendAPI();
            await testWebSocketConnection();
            await testFileUpload();
            await testExportFeatures();
            
            // ê²°ê³¼ ìš”ì•½
            generateSummary();
            displayResults();
            
            btn.disabled = false;
            btn.textContent = 'ğŸ§ª ë°°í¬ ìƒíƒœ í…ŒìŠ¤íŠ¸ ì‹œì‘';
        }
        
        async function testFrontend() {
            const test = { name: 'í”„ë¡ íŠ¸ì—”ë“œ ì ‘ê·¼ì„±', status: 'testing' };
            
            try {
                // í˜„ì¬ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆë‹¤ëŠ” ê²ƒì€ í”„ë¡ íŠ¸ì—”ë“œê°€ ì‘ë™í•œë‹¤ëŠ” ì¦ê±°
                test.status = 'pass';
                test.message = 'í”„ë¡ íŠ¸ì—”ë“œ ì •ìƒ ë¡œë“œë¨';
                test.details = {
                    url: window.location.href,
                    userAgent: navigator.userAgent,
                    screenSize: `${screen.width}x${screen.height}`
                };
            } catch (error) {
                test.status = 'fail';
                test.error = error.message;
            }
            
            testResults.tests.frontend = test;
        }
        
        async function testBackendAPI() {
            const test = { name: 'ë°±ì—”ë“œ API', status: 'testing' };
            
            const endpoints = [
                { url: 'http://localhost:8000/health', name: 'Health Check' },
                { url: 'http://localhost:8000/docs', name: 'API Docs' },
                { url: 'http://localhost:8000/api/campaigns/', name: 'Campaigns API' }
            ];
            
            let passCount = 0;
            const results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url, { method: 'GET' });
                    const success = response.ok || response.status === 401; // 401ì€ ì¸ì¦ í•„ìš”ë¡œ ì •ìƒ
                    
                    results.push({
                        name: endpoint.name,
                        url: endpoint.url,
                        status: response.status,
                        success: success
                    });
                    
                    if (success) passCount++;
                } catch (error) {
                    results.push({
                        name: endpoint.name,
                        url: endpoint.url,
                        error: error.message,
                        success: false
                    });
                }
            }
            
            test.status = passCount > 0 ? 'pass' : 'fail';
            test.message = `${passCount}/${endpoints.length} ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ê°€ëŠ¥`;
            test.details = results;
            
            testResults.tests.backend = test;
        }
        
        async function testWebSocketConnection() {
            const test = { name: 'WebSocket ì—°ê²°', status: 'testing' };
            
            try {
                const ws = new WebSocket('ws://localhost:8000/api/websocket/ws');
                
                await new Promise((resolve, reject) => {
                    const timeout = setTimeout(() => {
                        ws.close();
                        reject(new Error('ì—°ê²° íƒ€ì„ì•„ì›ƒ'));
                    }, 3000);
                    
                    ws.onopen = () => {
                        clearTimeout(timeout);
                        test.status = 'pass';
                        test.message = 'WebSocket ì„œë²„ ì—°ê²° ê°€ëŠ¥';
                        ws.close();
                        resolve();
                    };
                    
                    ws.onerror = (error) => {
                        clearTimeout(timeout);
                        // ì¸ì¦ ì˜¤ë¥˜ëŠ” ì„œë²„ê°€ ì •ìƒ ì‘ë™í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼
                        if (error.code === 1008) {
                            test.status = 'pass';
                            test.message = 'WebSocket ì„œë²„ ì •ìƒ (ì¸ì¦ í•„ìš”)';
                        } else {
                            test.status = 'fail';
                            test.error = 'ì—°ê²° ì‹¤íŒ¨';
                        }
                        resolve();
                    };
                    
                    ws.onclose = (event) => {
                        clearTimeout(timeout);
                        if (event.code === 1008) {
                            test.status = 'pass';
                            test.message = 'WebSocket ì„œë²„ ì •ìƒ (ì¸ì¦ í•„ìš”)';
                        }
                        resolve();
                    };
                });
                
            } catch (error) {
                test.status = 'fail';
                test.error = error.message;
            }
            
            testResults.tests.websocket = test;
        }
        
        async function testFileUpload() {
            const test = { name: 'íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥', status: 'testing' };
            
            try {
                const response = await fetch('http://localhost:8000/api/files/info');
                if (response.ok || response.status === 401) {
                    test.status = 'pass';
                    test.message = 'íŒŒì¼ ì—…ë¡œë“œ API ì ‘ê·¼ ê°€ëŠ¥';
                } else {
                    test.status = 'fail';
                    test.error = `HTTP ${response.status}`;
                }
            } catch (error) {
                test.status = 'warning';
                test.message = 'íŒŒì¼ ì—…ë¡œë“œ API í…ŒìŠ¤íŠ¸ ë¶ˆê°€';
                test.error = error.message;
            }
            
            testResults.tests.fileUpload = test;
        }
        
        async function testExportFeatures() {
            const test = { name: 'ë°ì´í„° ë‚´ë³´ë‚´ê¸°', status: 'testing' };
            
            try {
                const response = await fetch('http://localhost:8000/api/export/files');
                if (response.ok || response.status === 401) {
                    test.status = 'pass';
                    test.message = 'ë°ì´í„° ë‚´ë³´ë‚´ê¸° API ì ‘ê·¼ ê°€ëŠ¥';
                } else {
                    test.status = 'fail';
                    test.error = `HTTP ${response.status}`;
                }
            } catch (error) {
                test.status = 'warning';
                test.message = 'ë°ì´í„° ë‚´ë³´ë‚´ê¸° API í…ŒìŠ¤íŠ¸ ë¶ˆê°€';
                test.error = error.message;
            }
            
            testResults.tests.export = test;
        }
        
        function generateSummary() {
            const tests = Object.values(testResults.tests);
            const passCount = tests.filter(t => t.status === 'pass').length;
            const failCount = tests.filter(t => t.status === 'fail').length;
            const warningCount = tests.filter(t => t.status === 'warning').length;
            
            testResults.summary = {
                total: tests.length,
                passed: passCount,
                failed: failCount,
                warnings: warningCount,
                successRate: Math.round((passCount / tests.length) * 100),
                overallStatus: failCount === 0 ? 'healthy' : 'issues'
            };
        }
        
        function displayResults() {
            const resultsDiv = document.getElementById('testResults');
            const { tests, summary } = testResults;
            
            let html = `
                <div class="mb-6 p-4 rounded-lg ${summary.overallStatus === 'healthy' ? 'bg-green-50' : 'bg-yellow-50'}">
                    <h2 class="text-xl font-semibold mb-2">ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h2>
                    <div class="grid md:grid-cols-4 gap-4 text-sm">
                        <div>ì „ì²´: ${summary.total}</div>
                        <div class="status-pass">í†µê³¼: ${summary.passed}</div>
                        <div class="status-fail">ì‹¤íŒ¨: ${summary.failed}</div>
                        <div class="status-warning">ê²½ê³ : ${summary.warnings}</div>
                    </div>
                    <div class="mt-2 text-lg font-semibold ${summary.overallStatus === 'healthy' ? 'status-pass' : 'status-warning'}">
                        ì„±ê³µë¥ : ${summary.successRate}% - ${summary.overallStatus === 'healthy' ? 'âœ… ë°°í¬ ì¤€ë¹„ ì™„ë£Œ' : 'âš ï¸ ì¼ë¶€ ë¬¸ì œ í™•ì¸ í•„ìš”'}
                    </div>
                </div>
                
                <div class="space-y-3">
            `;
            
            for (const [key, test] of Object.entries(tests)) {
                const statusClass = test.status === 'pass' ? 'status-pass' : 
                                  test.status === 'fail' ? 'status-fail' : 'status-warning';
                const statusIcon = test.status === 'pass' ? 'âœ…' : 
                                 test.status === 'fail' ? 'âŒ' : 'âš ï¸';
                
                html += `
                    <div class="p-3 border rounded-lg ${test.status === 'pass' ? 'border-green-200 bg-green-50' : 
                                                        test.status === 'fail' ? 'border-red-200 bg-red-50' : 
                                                        'border-yellow-200 bg-yellow-50'}">
                        <div class="flex justify-between items-start">
                            <h3 class="font-semibold">${statusIcon} ${test.name}</h3>
                            <span class="${statusClass} text-sm font-medium">${test.status.toUpperCase()}</span>
                        </div>
                        <div class="text-sm text-gray-600 mt-1">
                            ${test.message || test.error || 'ìƒíƒœ í™•ì¸ ì¤‘...'}
                        </div>
                        ${test.details ? `<div class="text-xs text-gray-500 mt-2">ì„¸ë¶€ì‚¬í•­: ${JSON.stringify(test.details, null, 2).slice(0, 200)}...</div>` : ''}
                    </div>
                `;
            }
            
            html += `</div>`;
            resultsDiv.innerHTML = html;
        }
        
        function exportResults() {
            const dataStr = JSON.stringify(testResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `brandflow_deployment_test_${new Date().getTime()}.json`;
            link.click();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        window.onload = function() {
            document.getElementById('testResults').innerHTML = `
                <div class="text-center p-8">
                    <div class="text-6xl mb-4">ğŸš€</div>
                    <h2 class="text-2xl font-bold mb-4">BrandFlow ì‹œìŠ¤í…œ ë°°í¬ ê²€í† </h2>
                    <p class="text-gray-600 mb-6">
                        í˜„ì¬ ì‹œìŠ¤í…œì˜ ë°°í¬ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
                    </p>
                    <div class="grid md:grid-cols-3 gap-4 text-sm">
                        <div class="p-3 bg-blue-50 rounded">
                            <strong>ğŸŒ í”„ë¡ íŠ¸ì—”ë“œ</strong><br>
                            React ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ
                        </div>
                        <div class="p-3 bg-green-50 rounded">
                            <strong>ğŸ”§ ë°±ì—”ë“œ API</strong><br>
                            FastAPI ì„œë²„ ì—°ê²°ì„±
                        </div>
                        <div class="p-3 bg-purple-50 rounded">
                            <strong>âš¡ ì‹¤ì‹œê°„ ê¸°ëŠ¥</strong><br>
                            WebSocket ì—°ê²° ìƒíƒœ
                        </div>
                    </div>
                </div>
            `;
        };
    </script>
</body>
</html>